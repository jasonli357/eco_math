## 1. 标准形式

### 1.1 情形一：只有非负约束

$$
\begin{aligned}
    \max_x \quad &f(x) \\
    s.t. \quad &g(x)=r  \\
    &x \ge 0
\end{aligned}
$$

拉格朗日函数：

$$L = f(x) - \lambda [g(x)-r]$$

一阶条件：

$$
\begin{aligned}
    F.O.C \quad &\frac{\partial L}{\partial x} \le 0,\ x \ge 0,\ x \frac{\partial L}{\partial x} = 0 \\
    &\frac{\partial L}{\partial \lambda} = g(x) - r = 0
\end{aligned}
$$

### 1.2 情形二：有一般约束

$$
\begin{aligned}
    \max_x \quad &f(x) \\
    s.t. \quad &g(x)=r  \\
    &h(x) \le c \\
    &x \ge 0
\end{aligned}
$$

拉格朗日函数：

$$L = f(x) - \lambda [g(x)-r] - \mu [h(x)-c]$$

一阶条件：

$$
\begin{aligned}
    F.O.C \quad &\frac{\partial L}{\partial x} \le 0,\ x \ge 0,\ x \frac{\partial L}{\partial x} = 0 \\
    &\frac{\partial L}{\partial \lambda} = g(x) - r = 0 \\
    &\mu [c-h(x)]=0,\ \mu \ge 0,\ c-h(x) \ge 0
\end{aligned}
$$

#### 1.2.1 非负约束是一般约束的特例

$$
\begin{aligned}
    \max_x \quad &f(x) \\
    s.t. \quad &x \ge 0
\end{aligned}
$$

按一般约束的 FOC 求法，令 $h(x)=-x,\ c=0$，则 $x \ge 0$ 等价于 $h(x) \le c$

拉格朗日函数：

$$
L = f(x) - \mu [h(x)-c] = f(x)+\mu x
$$

一阶条件：

$$
\begin{aligned}
    F.O.C \quad &\frac{\partial L}{\partial x} = 0 \\
    &\mu [c-h(x)]=0,\ \mu \ge 0,\ c-h(x) \ge 0\\
    \Rightarrow \quad &f'(x) + \mu = 0 \\
    &\mu x=0,\ \mu \ge 0,\ x \ge 0
\end{aligned}
$$

上述 FOC 条件等价于以下两种情形其一成立：
1. $\lambda \ge 0,\ x=0,\ f'(x)=-\lambda \le 0$；
2. $\lambda = 0,\ x \ge 0,\ f'(x)= 0$

两种情形可以合并为：

$xf'(x)=0,\ x \ge 0,\ f'(x) \le 0$

这个就是非负约束的 FOC

### 1.3 最小化问题

$$
\begin{aligned}
    \min_x \quad &f(x) \\
    s.t. \quad &g(x)=r  \\
    &h(x) \ge c \\
    &x \ge 0
\end{aligned}
$$

可以转化为标准形式的最大化问题，用 1.2 的过程得到 $L$ 和 FOC。

等价最大化问题：

$$
\begin{aligned}
    \max_x \quad &-f(x) \\
    s.t. \quad &g(x)=r  \\
    &-h(x) \le -c \\
    &x \ge 0
\end{aligned}
$$

但是有更简便的方式，就是专门给最小化问题定义一个 $L'$ 和 FOC，使得新定义的 FOC 和上述等价最大化问题的 FOC 相同。

此处直接给出新定义的 $L'$ 和 FOC。

$$L' = f(x) - \lambda [r-g(x)] - \mu [h(x)-c] = -L$$

$$
\begin{aligned}
    F.O.C \quad &\frac{\partial L'}{\partial x} \ge 0,\ x \ge 0,\ x \frac{\partial L}{\partial x} = 0 \\
    &\frac{\partial L'}{\partial \lambda} = g(x) - r = 0 \\
    &\mu [h(x)-c]=0,\ \mu \ge 0,\ h(x)-c \ge 0
\end{aligned}
$$



### 1.4 小结

#### 1.4.1 最大化问题

**拉格朗日函数** = 目标函数 +（等式约束惩罚项：$-\lambda [g(x)-r]$）+（不等式约束惩罚项：$-\mu [h(x)-c]$）

> $g(x)-r$ 或 $h(x)-c$ 如果取值为正，经济含义是 “超预算”，所以这两项的含义是 “惩罚项”。所以前面的系数 $\lambda$ 和 $\mu$ 一定是正数，$\lambda$ 和 $\mu$ 前面一定是负号。

**一阶条件：遍历以下四种情况，凡是存在的都要设立对应的一阶条件**
- 无非负约束的变量 $x$：$\frac{\partial L}{\partial x} = 0$
- 有非负约束的变量 $x$：$\frac{\partial L}{\partial x} \le 0,\ x \ge 0,\ x \frac{\partial L}{\partial x} = 0$
- 等式约束：$\frac{\partial L}{\partial \lambda} = r-g(x) = 0$
- 不等式约束：$\mu[c-h(x)] = 0,\ \mu \ge 0,\ c-h(x) \ge 0$

#### 1.4.2 最小化问题

**拉格朗日函数** = 目标函数 +（等式约束奖励项：$-\lambda [r-g(x)]$）+（不等式约束奖励项：$-\mu [h(x)-c]$）

> 和最大化问题的拉格朗日函数对比：最小化情形下，目标是对拉格朗日函数求最小值，$-\lambda$ 和 $-\mu$ 后面的项如果取正数，能降低整个式子的值，所以是 “奖励项”。$r-g(x)$ 如果取值为正，表示 “预算有剩余”，$h(x)-c$ 如果取值为正，表示 “产出超出要求”。


> 对约束条件的理解：
>
> 条件 2：$\frac{\partial L}{\partial x} \le 0,\ x \ge 0,\ x \frac{\partial L}{\partial x} = 0$，可以用一元函数图像理解。在 $[0, \infty)$ 上， $L(x)$ 的极大值如果在 $x>0$ 处取得，极值处导数一定为 0。如果极大值在 $x=0$ 处取得，则此处的导数一定为负。
>
> 条件 4：$\mu[c-h(x)] = 0,\ \mu \ge 0,\ c-h(x) \ge 0$，可以理解为：若约束生效，即 $c-h(x) = 0$，则拉格朗日乘子为正，表示 “约束存在张力”；若约束不生效，即 $c-h(x) \ge 0$，则拉格朗日乘子为 0，表示 “约束是松弛的”
> 

**一阶条件：遍历以下四种情况，凡是存在的都要设立对应的一阶条件（令 $L'=-L$，套用最大化问题关于 $L$ 的 FOC 即可）**
- 无非负约束的变量 $x$：$\frac{\partial L}{\partial x} = 0$
- 有非负约束的变量 $x$：$\frac{\partial L}{\partial x} \ge 0,\ x \ge 0,\ x \frac{\partial L}{\partial x} = 0$
- 等式约束：$\frac{\partial L}{\partial \lambda} = r-g(x) = 0$
- 不等式约束：$\mu[h(x)-c] = 0,\ \mu \ge 0, h(x)-c \ge 0$

> 和最大化问题的FOC对比：有变化的只有第二个 FOC（有非负约束的变量 $x$）和第四个 FOC（不等式约束）

> 这两个条件同样可以类比最大化问题中的思路来理解。

--- -- -

## 2. KT 条件在常见最优化问题中的应用

### 2.1 UMP（效用最大化）

$$
\begin{aligned}
    \max_x \quad &u(x) \\
    s.t. \quad &px \le w  \\
    &x \ge 0
\end{aligned}
$$

拉格朗日函数：

$$L = u(x) - \lambda (px-w)$$

一阶条件：

$$
\begin{aligned}
    F.O.C \quad &\frac{\partial L}{\partial x} \le 0,\ x \ge 0,\ x \frac{\partial L}{\partial x} = 0 \\
    &\lambda (w-px)=0,\ \lambda \ge 0,\ w-px \ge 0
\end{aligned}
$$

根据瓦尔拉斯法则，预算约束（第二条 FOC）一般都会生效：$w-px=0, \lambda > 0$

代入 $\frac{\partial L}{\partial x} = u'(x) - \lambda p$ 的具体形式，第一条 FOC 等价于：

$u'(x) - \lambda p \le 0$，当 $x>0$ 时取等号。

所以最终的一阶条件可整理为：
- $w-px=0, \lambda > 0$
- $u'(x) - \lambda p \le 0$，当 $x>0$ 时取等号


### 2.2 PMP（利润最大化，单一产品情形）

$$
\begin{aligned}
    \max_z \quad &pf(z) - wz \\
    s.t. \quad &z \ge 0
\end{aligned}
$$

拉格朗日函数：

$$L = pf(z) - wz$$

一阶条件：

$$
\begin{aligned}
    F.O.C \quad &\frac{\partial L}{\partial z} \le 0,\ z \ge 0,\ z \frac{\partial L}{\partial z} = 0
\end{aligned}
$$

代入 $\frac{\partial L}{\partial z} = p f'(z) - w$：$z [p f'(z) - w]=0,\ pf'(z)-w \le 0,\ z \ge 0$

或者表示为：$z [p f'(z) - w] \le 0$，当 $z>0$ 时取等号

### 2.3 CMP（成本最小化）

$$
\begin{aligned}
    \min_z \quad &wz \\
    s.t. \quad &f(z) \ge q\\
    &z \ge 0
\end{aligned}
$$

拉格朗日函数：

$$L = wz - \lambda [f(z)-q]$$

一阶条件：

$$
\begin{aligned}
    F.O.C \quad &\frac{\partial L}{\partial z} \ge 0,\ z \ge 0,\ z \frac{\partial L}{\partial z} = 0 \\
    &\lambda [f(z)-q]=0,\ \lambda \ge 0,\ [f(z)-q] \ge 0
\end{aligned}
$$
